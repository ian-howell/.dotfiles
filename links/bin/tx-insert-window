#!/bin/bash

# Temporarily turn off window renumbering - it doesn't allow "holding cells"
tmux set renumber-windows off
trap 'tmux set renumber-windows on' EXIT

current_window=$(tmux list-windows | grep "\*" | cut -d: -f1)
target_window=$1

# Put our current window into a "holding cell"
tmux move-window -t 0

if (( current_window > target_window )); then
  # Shift the "middle" windows right
  while (( current_window > target_window )); do
    tmux move-window -s "$((current_window - 1))" -t "$current_window"
    (( current_window -= 1 ))
  done
else
  # Shift the "middle" windows right
  while (( current_window < target_window )); do
    tmux move-window -s "$((current_window + 1))" -t "$current_window"
    (( current_window += 1 ))
  done
fi

# Move our window from its "holding cell" to the target location
tmux move-window -s 0 -t "$target_window"

# This shouldn't be necessary, but If I did something stupid like specify an out
# of bounds target, this will ensure that windows are renumbered correctly.
tmux move-window -r
